<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare License Verification - Disease.Zone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .search-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .search-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            padding: 0 40px 40px;
        }

        .results-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e1e5e9;
        }

        .table-header h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .table-header p {
            color: #666;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-active {
            color: #28a745;
            font-weight: 600;
        }

        .status-inactive {
            color: #dc3545;
            font-weight: 600;
        }

        .status-unknown {
            color: #ffc107;
            font-weight: 600;
        }

        .violations-btn {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }

        .violations-btn:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
        }

        .disclaimer h4 {
            margin-bottom: 10px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .pricing-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .pricing-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .tier {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .tier h5 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Healthcare License Verification</h1>
            <p>Verify healthcare professional licenses and credentials</p>
        </div>

        <div class="search-section">
            <div class="disclaimer">
                <h4>‚ö†Ô∏è Important Notice</h4>
                <p>This service aggregates publicly available license information for verification purposes only. For official verification, always check with the appropriate state medical or nursing board. This information should not be used as the sole basis for hiring or credentialing decisions.</p>
            </div>

            <div class="search-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="providerName">Provider Name</label>
                        <input type="text" id="providerName" placeholder="Enter first and last name">
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <select id="state">
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="CA">California</option>
                            <option value="FL">Florida</option>
                            <option value="NY">New York</option>
                            <option value="TX">Texas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="city">City (Optional)</label>
                        <input type="text" id="city" placeholder="Enter city">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="licenseNumber">License/NPI Number (Optional)</label>
                        <input type="text" id="licenseNumber" placeholder="Enter license or NPI number">
                    </div>
                    <div class="form-group">
                        <label for="providerType">Provider Type</label>
                        <select id="providerType">
                            <option value="all">All Providers</option>
                            <option value="doctor">Doctors</option>
                            <option value="nurse">Nurses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="search-btn" onclick="searchLicenses()">
                            üîç Search Licenses
                        </button>
                    </div>
                </div>
            </div>

            <div class="pricing-info">
                <h4>üí∞ Service Tiers</h4>
                <div class="pricing-tiers">
                    <div class="tier">
                        <h5>Free</h5>
                        <p>25 searches/day<br>Basic license info</p>
                    </div>
                    <div class="tier">
                        <h5>Premium - $9.99/mo</h5>
                        <p>100 searches/day<br>Violation history</p>
                    </div>
                    <div class="tier">
                        <h5>Enterprise - $49.99/mo</h5>
                        <p>Unlimited searches<br>Full reports & API access</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-table">
                <div class="table-header">
                    <h3>Search Results</h3>
                    <p id="resultsInfo">Showing results for your search</p>
                </div>
                <div class="table-container">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>City/State</th>
                                <th>License #</th>
                                <th>Status</th>
                                <th>Valid Through</th>
                                <th>Specialty</th>
                                <th>Violations</th>
                                <th>Verify</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="loading" id="loadingSection" style="display: none;">
            <div class="spinner"></div>
            <p>Searching license databases...</p>
        </div>
    </div>

    <script>
        async function searchLicenses() {
            const name = document.getElementById('providerName').value.trim();
            const state = document.getElementById('state').value;
            const city = document.getElementById('city').value.trim();
            const licenseNumber = document.getElementById('licenseNumber').value.trim();
            const providerType = document.getElementById('providerType').value;

            // Validation
            if (!name && !licenseNumber) {
                alert('Please enter either a provider name or license number');
                return;
            }

            if (!state && !licenseNumber) {
                alert('Please select a state when searching by name');
                return;
            }

            // Show loading
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';

            try {
                // Build query parameters
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (state) params.append('state', state);
                if (city) params.append('city', city);
                if (licenseNumber) params.append('licenseNumber', licenseNumber);
                if (providerType) params.append('providerType', providerType);

                const response = await fetch(`/api/license-validation/search?${params}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Search failed');
                }

                displayResults(data);

            } catch (error) {
                console.error('Search error:', error);
                alert('Search failed: ' + error.message);
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
            }
        }

        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsBody = document.getElementById('resultsBody');
            const resultsInfo = document.getElementById('resultsInfo');

            // Clear previous results
            resultsBody.innerHTML = '';

            // Combine doctors and nurses
            const allResults = [...(data.results.doctors || []), ...(data.results.nurses || [])];

            if (allResults.length === 0) {
                resultsBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="no-results">
                            No licenses found matching your search criteria.<br>
                            Try searching with different terms or check with the state board directly.
                        </td>
                    </tr>
                `;
            } else {
                allResults.forEach(provider => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${provider.name}</strong></td>
                        <td>${provider.city}, ${provider.state}</td>
                        <td>${provider.licenseNumber || 'N/A'}</td>
                        <td><span class="status-${getStatusClass(provider.status)}">${provider.status}</span></td>
                        <td>${provider.validThrough || 'Unknown'}</td>
                        <td>${provider.specialty || 'N/A'}</td>
                        <td>
                            ${provider.violationsCount !== undefined ? 
                                `<button class="violations-btn" onclick="viewViolations('${provider.id}')" ${provider.violationsCount === 0 ? 'disabled' : ''}>
                                    ${provider.violationsCount} violations
                                </button>` : 
                                '<span style="color: #666;">Premium Only</span>'
                            }
                        </td>
                        <td>
                            <a href="${provider.verificationUrl}" target="_blank" style="color: #4facfe; text-decoration: none;">
                                üîó Verify
                            </a>
                        </td>
                    `;
                    resultsBody.appendChild(row);
                });
            }

            // Update info
            resultsInfo.textContent = `Found ${allResults.length} result(s) ‚Ä¢ ${data.userTier} tier ‚Ä¢ ${data.searchesRemaining} searches remaining`;

            // Show results
            resultsSection.style.display = 'block';
        }

        function getStatusClass(status) {
            if (status && status.toLowerCase().includes('active')) return 'active';
            if (status && status.toLowerCase().includes('inactive')) return 'inactive';
            return 'unknown';
        }

        async function viewViolations(providerId) {
            try {
                const response = await fetch(`/api/license-validation/provider/${providerId}/violations`);
                const data = await response.json();

                if (!response.ok) {
                    if (response.status === 403) {
                        alert('Premium subscription required to view detailed violation reports.\n\nUpgrade to Premium for $9.99/month to access violation history.');
                        return;
                    }
                    throw new Error(data.error || 'Failed to load violations');
                }

                // Display violations in a popup or modal
                let violationsText = `Violations for Provider ID: ${providerId}\n\n`;
                if (data.violations.length === 0) {
                    violationsText += 'No violations found.';
                } else {
                    data.violations.forEach((violation, index) => {
                        violationsText += `${index + 1}. ${violation.type}\n`;
                        violationsText += `   Date: ${violation.dateReported}\n`;
                        violationsText += `   Status: ${violation.status}\n`;
                        violationsText += `   Action: ${violation.boardAction}\n\n`;
                    });
                }

                alert(violationsText);

            } catch (error) {
                console.error('Violations error:', error);
                alert('Failed to load violations: ' + error.message);
            }
        }

        // Enable Enter key for search
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchLicenses();
            }
        });
    </script>
</body>
</html>